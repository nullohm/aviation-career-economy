<UserControl x:Class="Ace.App.Views.Core.FlightplanView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mapsui="clr-namespace:Mapsui.UI.Wpf;assembly=Mapsui.UI.Wpf"
             xmlns:controls="clr-namespace:Ace.App.Controls"
             mc:Ignorable="d" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             d:DesignHeight="600" d:DesignWidth="1000">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="56"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Border Grid.Row="0" Background="{StaticResource CardBg}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <Grid Margin="16,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Left: Title + Aircraft + Route Inputs -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Flight Plan" Style="{StaticResource HeadingText}" FontSize="20" VerticalAlignment="Center" Margin="0,0,24,0"/>

                    <!-- Aircraft Selection -->
                    <ComboBox x:Name="AircraftComboBox"
                              DisplayMemberPath="DisplayName"
                              SelectedValuePath="Id"
                              Width="200"
                              Height="32"
                              VerticalContentAlignment="Center"
                              Margin="0,0,20,0"/>

                    <!-- Departure ICAO -->
                    <StackPanel Orientation="Horizontal">
                        <TextBox x:Name="DepartureIcaoTextBox"
                                 Width="70"
                                 Height="32"
                                 FontSize="14"
                                 FontWeight="SemiBold"
                                 CharacterCasing="Upper"
                                 MaxLength="4"
                                 VerticalContentAlignment="Center"
                                 HorizontalContentAlignment="Center"
                                 Padding="4,0"/>
                        <ComboBox x:Name="DepartureIcaoComboBox"
                                  Width="28"
                                  Height="32"
                                  Margin="-1,0,0,0"
                                  IsTextSearchEnabled="False">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding DisplayText}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <Button x:Name="DepartureInfoButton"
                                Content="i"
                                FontStyle="Italic"
                                Height="32"
                                Margin="2,0,0,0"
                                Foreground="{StaticResource AccentBrush}"
                                Click="DepartureInfoButton_Click"
                                ToolTip="Show airport info"
                                Style="{StaticResource IconButtonStyle}"/>
                    </StackPanel>

                    <!-- Swap Button -->
                    <Button x:Name="SwapIcaoButton"
                            Content="â†”"
                            FontSize="16"
                            Width="32"
                            Height="32"
                            Margin="8,0"
                            Click="SwapIcaoButton_Click"
                            ToolTip="Swap Departure and Arrival"
                            Style="{StaticResource IconButtonStyle}"/>

                    <!-- Arrival ICAO -->
                    <StackPanel Orientation="Horizontal">
                        <TextBox x:Name="ArrivalIcaoTextBox"
                                 Width="70"
                                 Height="32"
                                 FontSize="14"
                                 FontWeight="SemiBold"
                                 CharacterCasing="Upper"
                                 MaxLength="4"
                                 VerticalContentAlignment="Center"
                                 HorizontalContentAlignment="Center"
                                 Padding="4,0"/>
                        <ComboBox x:Name="ArrivalIcaoComboBox"
                                  Width="28"
                                  Height="32"
                                  Margin="-1,0,0,0"
                                  IsTextSearchEnabled="False">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding DisplayText}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <Button x:Name="ArrivalInfoButton"
                                Content="i"
                                FontStyle="Italic"
                                Height="32"
                                Margin="2,0,0,0"
                                Foreground="{StaticResource AccentBrush}"
                                Click="ArrivalInfoButton_Click"
                                ToolTip="Show airport info"
                                Style="{StaticResource IconButtonStyle}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Center: Route Info Badge -->
                <Border Grid.Column="1"
                        Background="{StaticResource BgPrimary}"
                        CornerRadius="4"
                        Padding="12,4"
                        Margin="20,0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        x:Name="RouteInfoBadge"
                        Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock x:Name="DistanceText" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <TextBlock Text=" â€¢ " Foreground="{StaticResource SubtleForegroundBrush}" FontSize="13" VerticalAlignment="Center"/>
                        <TextBlock x:Name="CourseText" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <TextBlock Text=" â€¢ " Foreground="{StaticResource SubtleForegroundBrush}" FontSize="13" VerticalAlignment="Center"/>
                        <TextBlock x:Name="EstimatedTimeText" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <TextBlock Text=" â€¢ " Foreground="{StaticResource SubtleForegroundBrush}" FontSize="13" VerticalAlignment="Center"/>
                        <TextBlock x:Name="RouteRevenueText" FontSize="13" FontWeight="SemiBold" Foreground="{StaticResource AccentSecondaryBrush}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Right: Create Button -->
                <Button x:Name="CreateFlightPlanButton"
                        Grid.Column="2"
                        Height="36"
                        Padding="20,0"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="CreateFlightPlanButton_Click">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border"
                                    Background="{StaticResource AccentBrush}"
                                    CornerRadius="6"
                                    Padding="20,8">
                                <TextBlock Text="Create Flight Plan"
                                           Foreground="White"
                                           FontWeight="Bold"
                                           FontSize="13"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="#1E40AF"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="#1E3A8A"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>
        </Border>

        <!-- Map Container with Floating Panels -->
        <Grid Grid.Row="1">
            <!-- Map (Full Area) -->
            <mapsui:MapControl x:Name="FlightPlanMapControl"/>

            <!-- Airspace Tooltip (follows mouse) -->
            <Border x:Name="AirspaceTooltip"
                    Visibility="Collapsed"
                    IsHitTestVisible="False"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                    Background="{StaticResource CardBg}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="8,6">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="8" ShadowDepth="1" Opacity="0.3" Color="Black"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock x:Name="AirspaceTooltipName" FontWeight="SemiBold" FontSize="12"/>
                    <TextBlock x:Name="AirspaceTooltipClass" FontSize="11" Foreground="{StaticResource SubtleForegroundBrush}"/>
                    <TextBlock x:Name="AirspaceTooltipAltitude" FontSize="11" Foreground="{StaticResource SubtleForegroundBrush}"/>
                </StackPanel>
            </Border>

            <!-- Floating Panel: Suggested Routes (Left Top) -->
            <Border x:Name="SuggestedRoutesPanel"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                    Margin="16"
                    Width="300"
                    MaxHeight="420"
                    CornerRadius="8">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="16" ShadowDepth="2" Opacity="0.3" Color="Black"/>
                </Border.Effect>
                <Border.Background>
                    <SolidColorBrush Color="{Binding Source={StaticResource CardBg}, Path=Color}" Opacity="0.95"/>
                </Border.Background>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Header (Clickable to Toggle) -->
                    <Border Grid.Row="0"
                            Background="Transparent"
                            Padding="12,10"
                            Cursor="Hand"
                            MouseDown="SuggestedRoutesHeader_MouseDown">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock x:Name="RoutesToggleIcon" Text="â–¼" FontSize="10" Foreground="{StaticResource SubtleForegroundBrush}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Grid.Column="1" x:Name="SuggestedRoutesTitle" Text="Suggested Routes" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="2" x:Name="SuggestedRoutesCount" Text="(0)" FontSize="12" Foreground="{StaticResource SubtleForegroundBrush}" VerticalAlignment="Center"/>
                        </Grid>
                    </Border>

                    <!-- Routes List -->
                    <Border Grid.Row="1" x:Name="SuggestedRoutesContent" Visibility="Visible">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" MaxHeight="360">
                            <StackPanel>
                                <!-- No Routes Hint -->
                                <TextBlock x:Name="NoRoutesHint"
                                           Text="Enter a departure ICAO to see route suggestions"
                                           Foreground="{StaticResource SubtleForegroundBrush}"
                                           FontSize="12"
                                           TextWrapping="Wrap"
                                           TextAlignment="Center"
                                           Margin="12,8,12,12"/>

                                <!-- Routes ItemsControl -->
                                <ItemsControl x:Name="SuggestedRoutesListBox" Visibility="Collapsed" Margin="8,0,8,8">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="{StaticResource BgPrimary}"
                                                    Padding="10,8"
                                                    Margin="0,0,0,6"
                                                    CornerRadius="4"
                                                    Cursor="Hand"
                                                    MouseDown="RouteItem_MouseDown">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <StackPanel Grid.Column="0">
                                                        <TextBlock Text="{Binding DisplayText}"
                                                                   FontSize="14"
                                                                   FontWeight="SemiBold"
                                                                   Foreground="{StaticResource ForegroundBrush}"/>
                                                        <TextBlock Text="{Binding ShortDescription}"
                                                                   FontSize="11"
                                                                   Foreground="{StaticResource SubtleForegroundBrush}"
                                                                   Margin="0,2,0,0"/>
                                                    </StackPanel>
                                                    <TextBlock Grid.Column="1"
                                                               Text="{Binding RevenueDisplay}"
                                                               FontSize="13"
                                                               FontWeight="SemiBold"
                                                               Foreground="{StaticResource AccentSecondaryBrush}"
                                                               VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </ScrollViewer>
                    </Border>
                </Grid>
            </Border>

            <!-- Floating Panel: Route Details (Right Bottom) -->
            <Border x:Name="RouteDetailsPanel"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                    Margin="16"
                    Width="320"
                    CornerRadius="8"
                    Visibility="Collapsed">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="16" ShadowDepth="2" Opacity="0.3" Color="Black"/>
                </Border.Effect>
                <Border.Background>
                    <SolidColorBrush Color="{Binding Source={StaticResource CardBg}, Path=Color}" Opacity="0.95"/>
                </Border.Background>
                <StackPanel>
                    <!-- Route Header -->
                    <Border Background="{StaticResource BgPrimary}" Padding="16,12" CornerRadius="8,8,0,0">
                        <StackPanel>
                            <TextBlock x:Name="RouteText" FontSize="18" FontWeight="Bold" Foreground="{StaticResource ForegroundBrush}"/>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock x:Name="RouteDistanceText" FontSize="12" Foreground="{StaticResource SubtleForegroundBrush}"/>
                                <TextBlock Text=" â€¢ " FontSize="12" Foreground="{StaticResource SubtleForegroundBrush}"/>
                                <TextBlock x:Name="RouteCourseText" FontSize="12" Foreground="{StaticResource SubtleForegroundBrush}"/>
                                <TextBlock Text=" â€¢ " FontSize="12" Foreground="{StaticResource SubtleForegroundBrush}"/>
                                <TextBlock x:Name="RouteTimeText" FontSize="12" Foreground="{StaticResource SubtleForegroundBrush}"/>
                            </StackPanel>
                            <TextBlock x:Name="SelectedAircraftText" FontSize="11" Foreground="{StaticResource SubtleForegroundBrush}" Margin="0,4,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Range Warning -->
                    <Border x:Name="RangeWarningPanel" Background="#7F451A03" Padding="12,8" Visibility="Collapsed">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconWarning}" Fill="#F59E0B" Stretch="Uniform" Width="14" Height="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock x:Name="RangeWarningText" FontSize="12" Foreground="#F59E0B" TextWrapping="Wrap" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Flight Load Info -->
                    <Border Background="{StaticResource BgPrimary}" CornerRadius="6" Padding="12,10" Margin="12">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Passengers -->
                            <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,6">
                                <Path Data="{StaticResource IconPassengers}" Fill="{StaticResource AccentBrush}" Stretch="Uniform" Width="14" Height="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Passengers:" FontSize="13" Foreground="{StaticResource SubtleForegroundBrush}" VerticalAlignment="Center"/>
                                <TextBlock x:Name="PassengerLoadText" FontSize="13" FontWeight="SemiBold" Margin="6,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                            <TextBlock x:Name="PassengerRevenueText" Grid.Row="0" Grid.Column="1" FontSize="13" Foreground="{StaticResource AccentSecondaryBrush}" VerticalAlignment="Center"/>

                            <!-- Cargo -->
                            <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,6">
                                <Path Data="{StaticResource IconCargo}" Fill="{StaticResource AccentBrush}" Stretch="Uniform" Width="14" Height="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Cargo:" FontSize="13" Foreground="{StaticResource SubtleForegroundBrush}" VerticalAlignment="Center"/>
                                <TextBlock x:Name="CargoLoadText" FontSize="13" FontWeight="SemiBold" Margin="6,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                            <TextBlock x:Name="CargoRevenueText" Grid.Row="1" Grid.Column="1" FontSize="13" Foreground="{StaticResource AccentSecondaryBrush}" VerticalAlignment="Center"/>

                            <!-- Total Revenue -->
                            <Border Grid.Row="2" Grid.ColumnSpan="2" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0" Padding="0,8,0,0" Margin="0,4,0,0">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Total Revenue" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    <TextBlock x:Name="TotalRevenueText" Grid.Column="1" FontSize="16" FontWeight="Bold" Foreground="{StaticResource AccentSecondaryBrush}" VerticalAlignment="Center"/>
                                </Grid>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Complete Flight Plan Button (only when active) -->
                    <Border x:Name="FlightPlanDetailsPanel" Visibility="Collapsed" Margin="12,0,12,12">
                        <Button x:Name="CompleteFlightPlanButton"
                                Height="40"
                                BorderThickness="0"
                                Cursor="Hand"
                                HorizontalAlignment="Stretch"
                                Click="CompleteFlightPlanButton_Click"
                                ToolTip="Manually complete this flight plan using estimated values">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border"
                                            Background="#D97706"
                                            CornerRadius="6"
                                            Padding="16,8">
                                        <TextBlock Text="Complete Flight Plan"
                                                   Foreground="White"
                                                   FontWeight="Bold"
                                                   FontSize="13"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#B45309"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#92400E"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Unified Legend Panel (Left Bottom) -->
            <controls:MapLegendPanelControl x:Name="LegendPanel" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="16,0,0,48"/>

            <!-- Scale Control (Left Bottom, above hint) -->
            <controls:MapScaleControl x:Name="ScaleControl" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="16,0,0,16"/>

            <!-- Map Layer Toggle (Center Bottom, above hint) -->
            <Border HorizontalAlignment="Center"
                    VerticalAlignment="Bottom"
                    Margin="0,0,0,52"
                    Background="{StaticResource CardBg}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="4">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="8" ShadowDepth="1" Opacity="0.3" Color="Black"/>
                </Border.Effect>
                <StackPanel Orientation="Horizontal">
                    <Button x:Name="StreetLayerButton"
                            Content="Street"
                            Width="70"
                            Height="32"
                            FontSize="11"
                            Margin="0,0,2,0"
                            Click="StreetLayerButton_Click"
                            Style="{StaticResource IconButtonStyle}"/>
                    <Button x:Name="TerrainLayerButton"
                            Content="Terrain"
                            Width="70"
                            Height="32"
                            FontSize="11"
                            Margin="0,0,2,0"
                            Click="TerrainLayerButton_Click"
                            Style="{StaticResource IconButtonStyle}"/>
                    <Button x:Name="SatelliteLayerButton"
                            Content="Satellite"
                            Width="70"
                            Height="32"
                            FontSize="11"
                            Margin="0,0,2,0"
                            Click="SatelliteLayerButton_Click"
                            Style="{StaticResource IconButtonStyle}"/>
                    <Border Width="1" Height="20" Background="{StaticResource BorderBrush}" Margin="4,0"/>
                    <Button x:Name="AirportsLayerButton"
                            Content="Airports"
                            Width="70"
                            Height="32"
                            FontSize="11"
                            Margin="0,0,2,0"
                            Click="AirportsLayerButton_Click"
                            ToolTip="Toggle airport markers"
                            Style="{StaticResource IconButtonStyle}"/>
                    <Button x:Name="AirspaceLayerButton"
                            Content="Airspace"
                            Width="70"
                            Height="32"
                            FontSize="11"
                            Click="AirspaceLayerButton_Click"
                            ToolTip="Toggle airspace overlay"
                            Style="{StaticResource IconButtonStyle}"/>
                    <Button x:Name="AirspaceFilterButton"
                            Content="â–¼"
                            Width="24"
                            Height="32"
                            FontSize="9"
                            Click="AirspaceFilterButton_Click"
                            ToolTip="Airspace class filter"
                            Style="{StaticResource IconButtonStyle}"/>
                    <Border Width="1" Height="20" Background="{StaticResource BorderBrush}" Margin="4,0"/>
                    <Button x:Name="MeasureDistanceButton"
                            Content="ðŸ“"
                            Width="36"
                            Height="32"
                            FontSize="14"
                            Click="MeasureDistanceButton_Click"
                            ToolTip="Measure distance (click two points)"
                            Style="{StaticResource IconButtonStyle}"/>
                </StackPanel>
            </Border>

            <!-- Airspace Filter Popup -->
            <Popup x:Name="AirspaceFilterPopup"
                   PlacementTarget="{Binding ElementName=AirspaceFilterButton}"
                   Placement="Top"
                   StaysOpen="False"
                   AllowsTransparency="True">
                <Border Background="{StaticResource CardBg}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12"
                        Margin="0,0,0,8">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.4" Color="Black"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="Airspace Classes" FontWeight="SemiBold" FontSize="12" Margin="0,0,0,8"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" Margin="0,0,16,0">
                                <CheckBox x:Name="ChkAirspaceA" Content="Class A" Margin="0,2" Checked="AirspaceFilter_Changed" Unchecked="AirspaceFilter_Changed"/>
                                <CheckBox x:Name="ChkAirspaceB" Content="Class B" Margin="0,2" Checked="AirspaceFilter_Changed" Unchecked="AirspaceFilter_Changed"/>
                                <CheckBox x:Name="ChkAirspaceC" Content="Class C" Margin="0,2" Checked="AirspaceFilter_Changed" Unchecked="AirspaceFilter_Changed"/>
                                <CheckBox x:Name="ChkAirspaceD" Content="Class D" Margin="0,2" Checked="AirspaceFilter_Changed" Unchecked="AirspaceFilter_Changed"/>
                                <CheckBox x:Name="ChkAirspaceE" Content="Class E" Margin="0,2" Checked="AirspaceFilter_Changed" Unchecked="AirspaceFilter_Changed"/>
                                <CheckBox x:Name="ChkAirspaceCTR" Content="CTR/TMA" Margin="0,2" Checked="AirspaceFilter_Changed" Unchecked="AirspaceFilter_Changed"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1">
                                <CheckBox x:Name="ChkAirspaceRestricted" Content="Restricted" Margin="0,2" Checked="AirspaceFilter_Changed" Unchecked="AirspaceFilter_Changed"/>
                                <CheckBox x:Name="ChkAirspaceProhibited" Content="Prohibited" Margin="0,2" Checked="AirspaceFilter_Changed" Unchecked="AirspaceFilter_Changed"/>
                                <CheckBox x:Name="ChkAirspaceDanger" Content="Danger" Margin="0,2" Checked="AirspaceFilter_Changed" Unchecked="AirspaceFilter_Changed"/>
                                <CheckBox x:Name="ChkAirspaceGlider" Content="Glider" Margin="0,2" Checked="AirspaceFilter_Changed" Unchecked="AirspaceFilter_Changed"/>
                                <CheckBox x:Name="ChkAirspaceOther" Content="Other" Margin="0,2" Checked="AirspaceFilter_Changed" Unchecked="AirspaceFilter_Changed"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
            </Popup>

            <!-- Distance Measurement Display -->
            <Border x:Name="MeasureDistancePanel"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Top"
                    Margin="0,16,0,0"
                    Background="{StaticResource CardBg}"
                    BorderBrush="{StaticResource AccentBrush}"
                    BorderThickness="2"
                    CornerRadius="6"
                    Padding="16,10"
                    Visibility="Collapsed">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.4" Color="Black"/>
                </Border.Effect>
                <StackPanel Orientation="Horizontal">
                    <TextBlock x:Name="MeasureDistanceText" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center"/>
                    <Button Content="Ã—"
                            FontSize="14"
                            Width="24"
                            Height="24"
                            Margin="12,0,0,0"
                            Click="ClearMeasurement_Click"
                            ToolTip="Clear measurement"
                            Style="{StaticResource IconButtonStyle}"/>
                </StackPanel>
            </Border>

            <!-- Map Hint (Bottom Center) -->
            <Border x:Name="MapHintBorder"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Bottom"
                    Margin="0,0,0,16"
                    Background="{StaticResource CardBg}"
                    CornerRadius="4"
                    Padding="12,6"
                    Opacity="0.9">
                <TextBlock x:Name="MapHintText"
                           Text="Right-click on airport to set as Departure or Arrival"
                           Foreground="{StaticResource SubtleForegroundBrush}"
                           FontSize="11"/>
            </Border>

            <!-- Map Attribution (Bottom Right) -->
            <controls:MapAttributionControl x:Name="MapAttribution" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,16,16"/>
        </Grid>
    </Grid>
</UserControl>
